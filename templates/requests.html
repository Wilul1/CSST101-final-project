{% extends "base.html" %}

{% block title %}View All Requests - Service Request System{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1 class="mb-4"><i class="bi bi-list-ul"></i> All Service Requests</h1>
    </div>
</div>

<!-- Filters -->
<div class="card mb-4">
    <div class="card-body">
        <form method="GET" action="{{ url_for('view_requests') }}" class="row g-3">
            <div class="col-md-3">
                <label for="priority" class="form-label">Priority</label>
                <select class="form-select" id="priority" name="priority">
                    <option value="">All Priorities</option>
                    <option value="High" {% if priority_filter == 'High' %}selected{% endif %}>游댮 High</option>
                    <option value="Medium" {% if priority_filter == 'Medium' %}selected{% endif %}>游리 Medium</option>
                    <option value="Low" {% if priority_filter == 'Low' %}selected{% endif %}>游릭 Low</option>
                </select>
            </div>
            <div class="col-md-3">
                <label for="category" class="form-label">Category</label>
                <select class="form-select" id="category" name="category">
                    <option value="">All Categories</option>
                    <option value="Waste collection" {% if category_filter == 'Waste collection' %}selected{% endif %}>Waste collection</option>
                    <option value="Streetlight issue" {% if category_filter == 'Streetlight issue' %}selected{% endif %}>Streetlight issue</option>
                    <option value="Road repair" {% if category_filter == 'Road repair' %}selected{% endif %}>Road repair</option>
                    <option value="Noise complaint" {% if category_filter == 'Noise complaint' %}selected{% endif %}>Noise complaint</option>
                    <option value="Water service issue" {% if category_filter == 'Water service issue' %}selected{% endif %}>Water service issue</option>
                    <option value="Graffiti removal" {% if category_filter == 'Graffiti removal' %}selected{% endif %}>Graffiti removal</option>
                    <option value="Others" {% if category_filter == 'Others' %}selected{% endif %}>Others</option>
                </select>
            </div>
            <div class="col-md-3">
                <label for="status" class="form-label">Status</label>
                <select class="form-select" id="status" name="status">
                    <option value="">All Statuses</option>
                    <option value="Pending" {% if status_filter == 'Pending' %}selected{% endif %}>Pending</option>
                    <option value="In-Progress" {% if status_filter == 'In-Progress' %}selected{% endif %}>In-Progress</option>
                    <option value="Completed" {% if status_filter == 'Completed' %}selected{% endif %}>Completed</option>
                </select>
            </div>
            <div class="col-md-3">
                <label for="sort" class="form-label">Sort By</label>
                <select class="form-select" id="sort" name="sort">
                    <option value="date" {% if sort_by == 'date' %}selected{% endif %}>Date (Newest)</option>
                    <option value="priority" {% if sort_by == 'priority' %}selected{% endif %}>Priority</option>
                    <option value="category" {% if sort_by == 'category' %}selected{% endif %}>Category</option>
                    <option value="location" {% if sort_by == 'location' %}selected{% endif %}>Location</option>
                </select>
            </div>
            <div class="col-12">
                <button type="submit" class="btn btn-primary">
                    <i class="bi bi-funnel"></i> Apply Filters
                </button>
                <a href="{{ url_for('view_requests') }}" class="btn btn-outline-secondary">
                    <i class="bi bi-x-circle"></i> Clear Filters
                </a>
            </div>
        </form>
    </div>
</div>

<!-- Requests Table -->
<div class="card">
    <div class="card-header">
        <h5>Service Requests ({{ requests|length }} found)</h5>
    </div>
    <div class="card-body">
        {% if requests %}
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Category</th>
                        <th>Location</th>
                        <th>ML Priority</th>
                        <th>Status</th>
                        <th>Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for req in requests %}
                    <tr>
                        <td>{{ req.id }}</td>
                        <td>{{ req.category }}</td>
                        <td>{{ req.location }}</td>
                        <td>
                            {% if req.ml_priority == 'High' %}
                                <span class="badge bg-danger">游댮 High</span>
                            {% elif req.ml_priority == 'Medium' %}
                                <span class="badge bg-warning">游리 Medium</span>
                            {% else %}
                                <span class="badge bg-success">游릭 Low</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if req.status == 'Pending' %}
                                <span class="badge bg-warning">Pending</span>
                            {% elif req.status == 'In-Progress' %}
                                <span class="badge bg-info">In-Progress</span>
                            {% else %}
                                <span class="badge bg-success">Completed</span>
                            {% endif %}
                        </td>
                        <td>{{ req.created_at.strftime('%Y-%m-%d %H:%M') if req.created_at else 'N/A' }}</td>
                        <td>
                            <a href="{{ url_for('request_details', request_id=req.id) }}" class="btn btn-sm btn-outline-primary">
                                <i class="bi bi-eye"></i> Details
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="alert alert-info">
            <i class="bi bi-info-circle"></i> No requests found matching your filters.
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}


